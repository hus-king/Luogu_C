# 聚集方差（Aggregation Variance）

**时间限制**：2.0 秒  
**空间限制**：512 MiB  
**下载题目目录（样例文件）**：[链接待补充]

---

## 题目背景

对于一组数据 $ A = \{a_1, a_2, \dots, a_n\} $，通常使用**方差**来衡量其离散程度：

$$
\sigma^2(A) = \frac{1}{n} \sum_{i=1}^{n} (a_i - \mu(A))^2
$$

其中，平均值 $\mu(A) = \frac{1}{n} \sum_{i=1}^{n} a_i$。

然而，在现实场景中，数据有时呈现“分组聚集”特性：数据可被划分为若干子组，每组内部数值接近（聚集），但组间差异显著，导致整体方差较大。此时，传统方差无法反映这种局部聚集结构。

为此，我们提出一种新的度量方式——**聚集方差（Aggregation Variance）**：

定义数据集 $ A = \{a_1, a_2, \dots, a_n\} $ 的聚集方差为：

$$
G(A) = \frac{1}{n} \sum_{i=1}^{n} \min_{\substack{j=1 \\ j \ne i}}^{n} (a_i - a_j)^2
$$

特别地，当 $ n = |A| = 1 $ 时，规定 $ G(A) = 0 $。

### 示例说明

考虑集合 $ A = \{0, 0, 0, 4, 4, 4, 7, 8, 9\} $：

- 方差：$\sigma^2(A) = \frac{98}{9} \approx 10.89$
- 聚集方差：
  $$
  G(A) = \frac{1}{9} \left[ 3 \cdot (0-4)^2 + 3 \cdot (4-0)^2 + 3 \cdot \min\{(7-4)^2, (8-7)^2, (9-8)^2\} \right] = \frac{1}{9}(3 \cdot 16 + 3 \cdot 16 + 3 \cdot 1) = \frac{99}{9} = 11? 
  $$

## 题目描述

考虑一个公司组织结构，可用一棵**有根树**表示：

- 每个节点代表一名员工；
- 父节点是其直属上司；
- 子树（包括自身）代表该员工可支配的所有员工（含自己）。

设公司共有 $ n $ 名员工，编号从 $ 1 $ 到 $ n $。

对员工 $ x $，记 $ T(x) $ 为其子树中所有员工编号的集合（包含 $ x $ 自身）。

对 $ x > 1 $，记 $ p_x $ 为其父节点编号，且保证 $ 1 \le p_x < x $，因此员工 1 是唯一的根节点（老板）。

每位员工每年有一小时自主选择的带薪年假，其偏好时间用一个非负整数 $ a_x $ 表示。

定义：

$$
A(x) = \{ a_y \mid y \in T(x) \}
$$

为员工 $ x $ 的子树中所有员工的偏好时间构成的**多重集合**，其大小为 $ |A(x)| = |T(x)| $。

我们定义员工 $ x $ 的**聚集方差**为：

$$
G(A(x)) = \frac{1}{|T(x)|} \sum_{y \in T(x)} \min_{\substack{z \in T(x) \\ z \ne y}} (a_z - a_y)^2
$$

若 $ G(A(x)) $ 较小，说明该员工下属的请假时间高度集中，可能导致工作冲突，需调整安排；反之则无需担忧。

由于精度问题，**我们不输出 $ G(A(x)) $**，而是输出：

$$
V_x = |T(x)| \cdot G(A(x)) = \sum_{y \in T(x)} \min_{\substack{z \in T(x) \\ z \ne y}} (a_z - a_y)^2
$$

可以证明：$ V_x $ 总是**整数**。

---

## 输入格式

从标准输入读入：

- 第一行：一个正整数 $ n $，表示员工总数。
- 第二行：$ n-1 $ 个正整数 $ p_2, p_3, \dots, p_n $，分别表示员工 $ 2 $ 到 $ n $ 的父节点编号。
- 第三行：$ n $ 个非负整数 $ a_1, a_2, \dots, a_n $，表示每位员工的偏好时间。

---

## 输出格式

输出 $ n $ 行，第 $ i $ 行输出一个非负整数 $ V_i $，即员工 $ i $ 的子树对应的聚集方差乘以子树大小后的结果。

---

## 样例输入与输出

### 样例1

**输入**：
```
2
1
0 1
```

**输出**：
```
2
0
```

### 解释：

- 员工1是根，员工2的父是1。
- $ a_1 = 0, a_2 = 1 $

#### 对员工1（根）：
- $ T(1) = \{1, 2\} $，$ A(1) = \{0, 1\} $
- 对 $ y=1 $：最近的是 $ z=2 $，$ (0-1)^2 = 1 $
- 对 $ y=2 $：最近的是 $ z=1 $，$ (1-0)^2 = 1 $
- $ V_1 = 1 + 1 = 2 $

#### 对员工2：
- $ T(2) = \{2\} $，单元素，$ G(A(2)) = 0 \Rightarrow V_2 = 0 $

---

## 子任务

| 子任务编号 | $ n \le $ | 特殊性质 | 分值 |
|------------|-------------|-----------|------|
| 1          | 300         | /         | 15   |
| 2          | 3,000       | /         | 25   |
| 3          | $ 3 \times 10^5 $ | A         | 15   |
| 4          | $ 3 \times 10^5 $ | B         | 10   |
| 5          | $ 3 \times 10^5 $ | C         | 10   |
| 6          | $ 3 \times 10^5 $ | /         | 25   |

### 特殊性质说明：

- **A**：对所有 $ i \in (1, n] $，有 $ p_i = i - 1 $（树为链状）
- **B**：对所有 $ i \in (1, n] $，有 $ p_i = \left\lfloor \frac{i}{2} \right\rfloor $（完全二叉树）
- **C**：对所有 $ i \ne j $，有 $ a_i \ne a_j $（所有偏好时间互不相同）

### 数据范围保证：

- $ 2 \le n \le 3 \times 10^5 $
- $ \forall i \in (1, n],\ p_i \in [1, i) $
- $ \forall i \in [1, n],\ a_i \in [0, 10^9] $

